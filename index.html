<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <title>Oficina ‚Äì Capta√ß√£o de √Ågua de Chuva (3D)</title>

  <!-- CSS principal (tema completo) -->
  <link rel="stylesheet" href="style.css" />

  <!-- Fallback cr√≠tico: garante que a cena e fundo renderizem mesmo se o style.css n√£o carregar -->
  <style>
    html,body{height:100%}
    body{margin:0;background:#0f1115;color:#eef1f7;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Inter,Arial,sans-serif;overflow:hidden}
    #scene{position:fixed;inset:0} /* garante o canvas full-screen */
    /* deixar os pain√©is minimamente leg√≠veis sem o CSS externo */
    .topbar,.panel,.tester,.footer{position:fixed;background:#171a21cc;color:#eef1f7;padding:8px;border-radius:10px}
    .topbar{left:12px;top:12px}
    .panel{right:12px;top:12px;max-width:380px}
    .tester{left:12px;bottom:12px}
    .footer{right:12px;bottom:12px;font-size:12px;opacity:.7}
  </style>

  <!-- (N√£o precisa de import-map; os imports foram resolvidos por URL dentro do script.js) -->
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
</head>
<body>
  <canvas id="scene"></canvas>

  <div class="topbar" role="region" aria-label="Legenda do projeto">
    <div class="title">Capta√ß√£o de √Ågua de Chuva ‚Äì Oficina de Martelinho / Lava R√°pido</div>
    <div class="subtitle">
      Telhado <b style="color:#ff7a00">laranja</b>, calhas/canos <b style="color:#9e9e9e">cinza</b>,
      fluxo d‚Äô√°gua <b style="color:#2196f3">azul</b> e 6 pilares.
    </div>
    <div class="legend">
      <div class="swatch"><span class="dot roof"></span>Telhado</div>
      <div class="swatch"><span class="dot gutter"></span>Calhas & Canos</div>
      <div class="swatch"><span class="dot water"></span>√Ågua</div>
      <div class="swatch"><span class="dot pillar"></span>6 Pilares</div>
    </div>
  </div>

  <div class="panel" role="region" aria-label="Controles">
    <h3>Controles</h3>
    <div class="row"><label><input id="toggleWater" type="checkbox" checked> Mostrar fluxo de √°gua</label></div>
    <div class="row"><label><input id="toggleRain" type="checkbox" checked> Simular chuva</label></div>
    <div class="row"><label><input id="toggleLabels" type="checkbox"> Mostrar r√≥tulos</label></div>

    <div class="row"><label><input id="toggleAuto" type="checkbox"> Girar c√¢mera automaticamente</label></div>
    <div class="row"><label>Velocidade rota√ß√£o</label>
      <input id="speed" type="range" min="0.1" max="6" step="0.1" value="1.2">
      <span id="speedVal" style="width:36px;text-align:right;font-size:12px;">1.2</span>
    </div>
    <div class="row" style="align-items:flex-start; gap:12px">
      <div>
        <div style="font-size:12px; color:#cdd3e0; margin-bottom:6px">Girar manualmente</div>
        <div class="camgrid">
          <span></span><button id="camUp" aria-label="Girar para cima">‚ñ≤</button><span></span>
          <button id="camLeft" aria-label="Girar para a esquerda">‚óÄ</button>
          <button id="camReset" aria-label="Resetar c√¢mera">‚óè</button>
          <button id="camRight" aria-label="Girar para a direita">‚ñ∂</button>
          <span></span><button id="camDown" aria-label="Girar para baixo">‚ñº</button><span></span>
        </div>
      </div>
      <button class="btn" id="export" aria-label="Exportar imagem em PNG">üì∏ Exportar imagem (PNG)</button>
    </div>

    <details class="blk">
      <summary>Onde fica cada elemento</summary>
      <ul class="list">
        <li><b>Calha principal</b>: beiral direito (longitudinal).</li>
        <li><b>Calha frontal</b>: borda da frente ‚Üí descida.</li>
        <li><b>Condutor vertical</b>: canto dianteiro direito.</li>
        <li><b>Filtro</b>: piso frontal direito (ap√≥s tubula√ß√£o).</li>
        <li><b>Bomba</b>: ao lado do filtro.</li>
        <li><b>Reservat√≥rio</b>: <i>subterr√¢neo</i> com tamp√£o no piso.</li>
        <li><b>Ralo linear</b>: centro do piso.</li>
        <li><b>Lavadora + mangueira</b>: canto traseiro esquerdo.</li>
        <li><b>Arco de espuma</b>: box esquerdo.</li>
        <li><b>Faixas + cones</b>: demarca√ß√£o dos boxes.</li>
      </ul>
    </details>
  </div>

  <!-- Painel Sustentabilidade -->
  <div class="panel sustain" role="region" aria-label="Sustentabilidade e estimativas">
    <h3>Estimativa de capta√ß√£o (Santo Andr√©, SP)</h3>
    <div class="grid2">
      <label>√Årea do telhado (m¬≤)<input id="roofArea" type="number" min="10" step="1" value="96"></label>
      <label>Coef. escoamento (0‚Äì1)<input id="runoff" type="number" min="0.1" max="0.95" step="0.05" value="0.85"></label>
      <label>Perdas ‚Äúfirst flush‚Äù (%)<input id="lossPct" type="number" min="0" max="30" step="1" value="10"></label>
      <label>Chuva anual (mm)
        <select id="rainAnnual">
          <option value="1500">Conservador ~1500</option>
          <option value="1880" selected>M√©dio ~1880</option>
          <option value="2118">√ömido ~2118</option>
        </select>
      </label>
      <label>Litros por lavagem<input id="litersPerWash" type="number" min="20" step="10" value="80"></label>
      <label>Lavagens/dia<input id="washesPerDay" type="number" min="1" step="1" value="20"></label>
    </div>
    <div class="metrics">
      <div><span class="muted small">Capta√ß√£o estimada/ano</span><div id="capYear" class="strong">‚Äî</div></div>
      <div><span class="muted small">Capta√ß√£o m√©dia/dia</span><div id="capDay" class="strong">‚Äî</div></div>
      <div><span class="muted small">Demanda/dia</span><div id="demDay" class="strong">‚Äî</div></div>
      <div><span class="muted small">Cobertura da demanda</span><div id="coverage" class="strong">‚Äî</div></div>
    </div>
    <div class="hint">F√≥rmula: <span class="mono">Volume = √Årea √ó (Chuva/1000) √ó Coef. √ó (1 ‚àí Perdas)</span>.</div>
  </div>

  <!-- Testes -->
  <div class="tester" id="tester" role="region" aria-label="Testes autom√°ticos">
    <h4>Testes autom√°ticos (smoke tests)</h4>
    <div class="tests" id="tests"></div>
    <button class="btn" id="rerun">Rodar novamente</button>
  </div>

  <div class="footer">Projeto acad√™mico ‚Äì Ecologia & Sustentabilidade ‚Ä¢ Reuso de √°gua de chuva</div>

  <!-- Script principal (m√≥dulo) -->
  <script type="module" src="script.js"></script>
</body>
</html>
